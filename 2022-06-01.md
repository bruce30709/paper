<style>
.green {
  background-color: #DEFFDE;
  color: #009400;
}
.blue {
  background-color: #DEFFFF;
  color: #5959FF;
}
.red {
  color: #DC143C;
}
</style>
###### tags: `paper`
# 導讀CleanG—Improving the Architecture and Protocols for Future Cellular Networks With NFV
## Terms
### <span class="green" id="4G">**LTE (4G) 系統架構**</span>
:::success
![](https://i.imgur.com/SzHbm3g.png)
Evolved Packet Core (EPC) 是4G網路的核網，其為許多硬體元件組成。

為了給 User devices/equipmen (UE) 提供移動性，從而提供不同的 Qos，所以需要 GPRS Tunneling Protocol (GTP) 協議的支持，在這些硬體元件之間建立 GTP 通道。
:::

### <span class="green" id="5G">**5G 系統架構**</span>
:::success
![](https://i.imgur.com/R7HZYSz.png)
5G 網路有了 SDN 的概念，把 Control 和 User Plane 分離，本篇稱為 CUPS 架構。

也就是說，原本的硬體元件會拆成 control plane 和 data plane，並會由不同的虛擬元件處理，使用 NFV 來部屬，可以參考 [4G 和 5G 的核網元件比較圖](#4G5G)。

:::

## I. INTRODUCTION
作者提出了一個改進 5G 核網的 NFV 架構，主要的貢獻分成以下 4 點。
1. 在 5G 核網內使用 SDN 和 NFV，以達到方便擴充及支持處理動態的要求的目的。
1. 作者觀察3GPP protocal，發現 5G 和 LTE 相比，在 control plane 保留了許多的信令交換。
1. 作者提出了藉由消除 GTP tunnels 的想法，且利用 shared memory 的支持來簡化 control plane 不必要的信令交換。
1. 作者實作了 CleanG ，一個基於行動電信網路的架構及協定，修改自 openNetVM 框架，並且拿 4G 網路跟 5G 網路作為其之實驗比較對象。
## II. BACKGROUND
> 這裡複習一下 4G 和 5G 網路，建議可以修課 or 旁聽楊舜仁的行動電信網路。
以下為以前的同學跟柏諺學長提供的考試筆記，可以參考~
Part1: https://hackmd.io/@fmKavjlOTTGTfTur52ds1w/HkyMHFW3Q?type=view
Part2: https://hackmd.io/@fmKavjlOTTGTfTur52ds1w/S1LkGZ2TQ?type=view
Part3: https://hackmd.io/@fmKavjlOTTGTfTur52ds1w/rJS0u92WE?type=view
Part4: https://hackmd.io/@lby106u/Mobile_Telecommunications?fbclid=IwAR39FQmssfM_c5QOUz2Wbp1bNjV1bsMGwMisdW4wOMb9J9BFYUEH0OIons4

首先講 4G 架構，以 [LTE (4G)](#4G) 系統架構圖為例，UEs 向 eNodeBs 通訊發出封包，eNodeBs 收到後，傳遞至 EPC 處理，最後才前往 packet data network (PDN)。 

EPC 主要由 Mobility Management Entity (MME)、Serving Gateway (SGW)、Packet Data Network Gateway (PGW)、Home Subscriber Server (HSS)，Policy and Charging Rules Function (PCRF)組成。而從 PGW 到 UEs 之間會建立一條虛擬的通道，我們稱 GTP tunnel。
以下針對各個元件依序進行簡單說明。
* SGW是進入點，負責 UEs 的 mobility 和換手。
* PGW 可以想像成是出口，負責 IP 分配，執行 policy，收費和封包的攔查。
* MME 是4G網路主要的管理元件，負責session(會話)管理和用戶的認證。
* HSS 可以想像成資料庫，負責儲存用戶訊息和加密資訊及用戶的位置。
* PCRF 負責政策與收費規則。

接著講 5G 架構，以 [5G](#5G) 系統架構圖為例，條列來比較:
* SGW 和 PGW 的 data plane 由 User Plane Functions (UPFs) 負責。
* Session Management Function (SMF) 接手了 control plane 的部分。
* Access and Mobility Management function (AMF) 接手原本 MME 的工作。
* Authentication server function (AUSF) 負責原先有關 [MME/AAA 認證](https://www.itsfun.com.tw/AAA%E4%BC%BA%E6%9C%8D%E5%99%A8/wiki-3551511-6428801) 的工作。
* Unified Data Management (UDM) 則接手了 HSS的工作。

他們的比較可以參考下圖。  

<span id="4G5G"> ![](https://i.imgur.com/9IiSO1c.png) </span>

在 3GPP 的標準中，用戶的封包使用 GTP-U (user plane) tunnel 來傳送，而 GTP-C (control plane) tunnel 用來傳送管理的信令。一個用戶可能同時擁有多個通道，這些通道用 TEID (Tunnel Endpoint Identifier) 來識別。而通道的建立和管理的花費相當的高，作者將在後續提出解決的方法。

## III. PROPOSED CLEANG ARCHITECTURE
* CleanG 是基於 OpenNetVM 框架，藉由DPDK開發工具包來達到高性能(低延遲高吞吐量)。
* CleanG 系統架構的一個主要目標是最大限度地減少 cellular network 整體 control plane 的 延遲。
* CleanG 架構利用在 OpenNetVM 上通過共享數據和狀態來運行 NFs，將這種延遲降到最低，例如:  shared memory、buffers、queues。

[CleanG 架構](#cleang) 的兩個主要組成部分是 <font color="purple"> CoreData </font> 和 <font color="red"> CoreControl </font> NFs，分別實現 cellular network 的 data plane 和 control plane。<font color="purple"> CoreData </font> 組件負責接收所有來自網路接口  (猜測是 DMA 轉移後的 receive buffer) 的數據包，encapsulates/decapsulates 並根據 <font color="red"> CoreControl </font> 提供的規則轉發數據包。 此部分可以使用 DPDK 的 [cuckoo hash](https://www.sdnlab.com/community/article/910) 在 shared memory 中完成。 

另一種方法是使用一個獨立轉發數據包的 NF 的元件，在 <font color="purple"> CoreData </font> 和 <font color="red"> CoreControl </font> NFs 之間對數據包進行 [demultiplexes](https://www.google.com/url?sa=i&url=https%3A%2F%2Fithelp.ithome.com.tw%2Farticles%2F10282436&psig=AOvVaw1zfqqYsBPby-GCdQLxrhns&ust=1654159798876000&source=images&cd=vfe&ved=0CAwQjRxqFwoTCKCojs3vi_gCFQAAAAAdAAAAABAT)。這部分 OpenNetVM 有做到，即提供一個指向共享內存中的數據包緩衝區的描述符 (descriptor) 來實現。主要是針對送進 <font color="red"> CoreControl </font> NF 的 control messages。作者提到 OpenNetVM 中的 Flow Director NF 可以做到此種行為，故作者直接拿來整合進架構中。


<span id="cleang">![](https://i.imgur.com/RIwenvz.png)</span>

* 在本篇的的設計中
    <font color="purple"> CoreData </font> NF 負責:
    1. 從網路接口讀取所有數據包，此舉可以節省 CPU clock cycle。
        > 這句話我的理解是，NFManager 不需要去負責 polling 數據包，省下的是此處的 clock cycle。
    1. 如果沒有數據包的規則（例如: control packets），<font color="purple"> CoreData </font>將這些數據包轉發給 <font color="red"> CoreControl </font> 元件。
        > 這句話看不是很懂，是說可能沒有 control packet??

    <font color="red"> CoreControl </font> NF 負責:
    1. 接收來自 UE/eNodeB 的 control message。
    2. 產生 response、更新 hash table 中的 entry。
    3. 將 response 送回 UE/eNodeB。

另外，作者提到可以根據需求動態地運行 <font color="purple"> CoreData </font> 和 <font color="red"> CoreControl </font> 的多個副本，如果數據轉發是限制因素，可以創建一個額外的 <font color="purple"> CoreData</font>。同樣地，當 control plane 訊息的處理成為瓶頸時（例如，在物聯網環境中），可以增加 <font color="red"> CoreControl </font> 的數量，剩餘的 CPU 算力則用來跑其他的 NFs。

### A. Deployment Considerations
為了處理多個用戶，多個 CleanG core 可以跑在運營商的同一個邊緣數據中心，構成 Core pool，一個 Core pool 支援多個 eNodeBs，如[示意圖](#core_pool)。
<span id="core_pool">![](https://i.imgur.com/K5sADZU.png)</span>

而 Core pool 的覆蓋範圍取決於對延遲的要求，如果對延遲要求越有彈性，則覆蓋面積可以較大，反之則較小。另一方面，如果廣泛部署 EPC 可以減少 UE 之間通信的延遲，但又會造成管理的困難。CleanG 追求這之間的平衡，因為做了以下的設計。

* Control plane 採用簡單且大規模集中式的部署，可減少 control plane 和 data plane 交互的延遲。
* 多個 data planes 元件由一個 control plane 元件管理，有助於實施 network slice。

從 eNodeB 的角度來看，一個 eNodeB 可以連接到多個 Core Pools，具體配置由運營商自己決定。一個 UE 的 session 會和其連線到的 eNodeB 所在範圍的 Core Pools 的 NF 維持不中斷 (一次只會連接一個Core Pool)。作者希望 UEs 不要在不同的 Core pools 之間頻繁做切換。

因此在不同 Core Pools 之間切換只發生在大規模移動跟管理延遲的時候。
>看不太懂管理延遲是甚麼意思?) 
## IV. PROPOSED CLEANG PROTOCOL
### A. Overview

### B. Forwarding Data Packets in CleanG
![](https://i.imgur.com/2rftc7Y.png)

### C. CleanG Control Plane Protocol
1) Initial Attach
![](https://i.imgur.com/ZJlR3Dc.png)
![](https://i.imgur.com/k6WAcg6.png)
![](https://i.imgur.com/OZsCqhZ.png)

2) Service Request (Idle-to-Active)
![](https://i.imgur.com/LxoF6nW.png)
![](https://i.imgur.com/dIBfaGW.png)

3) Handover
![](https://i.imgur.com/on5CAjG.png)
![](https://i.imgur.com/gXJjWiw.png)
![](https://i.imgur.com/FSzJJxk.png)

4) Active-to-Idle
![](https://i.imgur.com/ETEhIkL.png)
![](https://i.imgur.com/fZIBIew.png)
5) Detach
![](https://i.imgur.com/dLfSwqw.png)
![](https://i.imgur.com/KMrah7p.png)

### D. Implementing Network Slicing With CleanG
![](https://i.imgur.com/JRA0iEW.png)

## V. EVALUATION
![](https://i.imgur.com/CvWk1EG.png)
![](https://i.imgur.com/JkiACNl.png)
![](https://i.imgur.com/X4RqCoo.png)
![](https://i.imgur.com/ZlmJTaI.png)

### A. Total Number of Supported Users & B. Maximum Data Plane Rate
![](https://i.imgur.com/BYH9PUE.png)

### C. Total UE Event Completion Times
![](https://i.imgur.com/UQTSMyo.png)
![](https://i.imgur.com/khiTuH0.png)

### D. Data Packet Forwarding Latency
![](https://i.imgur.com/PnGMaNw.png)

### E. Detailed Timing of Different Events
![](https://i.imgur.com/ID9ugSo.png)
![](https://i.imgur.com/ZNmqTbW.png)
![](https://i.imgur.com/vggpd64.png)
